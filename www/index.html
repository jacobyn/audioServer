<!DOCTYPE html>
<html>
<head>
    <script src="http://code.createjs.com/easeljs-0.7.0.min.js"></script>
    <script>
    var SQ_X=20; // begining of square
	var SQ_Y=20; // begining of square
	var SQ_W=600; // width of square
	var SQ_H=100; // height of square
	var SQ_R=3; //roundness of square (aethtetics)
	var PROX_T=11;

	// inputs:
	var TRUE_RATIO=30; // input 
	var IS_FEEDBACK=true; //give feedback?

	var WAIT_TIME=2000; // in between trials wait time
	var MAX_REPATS=3;   // maximal number of repetiotions to try find correct response
	
	var DEBUG=true; // plot internal variables (for debug puropose)

	// outputs:
	var results=[]; //output list
	var result;    //the final output (NaN if incorrect)
	var repeats=0; //number of repeats


	var stage; // global variable holding the stage (canvas)

        function init() {
            stage = new createjs.Stage("demoCanvas");

            var square = new createjs.Shape();
			square.graphics.setStrokeStyle(2).beginStroke("black").beginFill("gray").drawRoundRect(SQ_X, SQ_Y, SQ_W, SQ_H,SQ_R,SQ_R,SQ_R,SQ_R);
			stage.addChild(square);
			stage.update();
			square.addEventListener("click", handleClick);
		 	document.getElementById("Target").innerHTML= "Target: "+ TRUE_RATIO + " % ";
			document.getElementById("Target").style.color = "green";
			document.getElementById("Feedback").style.color = "black";
			document.getElementById("Feedback").innerHTML="Segment the square according to the target's percentage:"
         }

		  // Click happenened
         function handleClick(event){
  		   
  		   res_x= event.stageX-SQ_X;
  		   res_xr=Math.round(100*(res_x - SQ_X)/SQ_W);
  		   true_xr=TRUE_RATIO;
  		   true_x=SQ_W*true_xr/100;
  		   var isCorrect=false;
  		   results.push(res_xr);

  		   if (Math.abs(res_xr-true_xr)<PROX_T) {
  		   	isCorrect=true;
  		   	result=res_xr; 
  		   } else {
  		   	result=NaN;
  		   }
  		   repeats=repeats+1;


  		   var square = new createjs.Shape(); // this will paint over original square also will not allow furhter clicking (hide square)
  		   if (isCorrect) {
	  		   square.graphics.setStrokeStyle(3).beginStroke("green").beginFill("gray").drawRoundRect(SQ_X, SQ_Y, SQ_W, SQ_H,SQ_R,SQ_R,SQ_R,SQ_R);
	  		}
	  		else {
	  			square.graphics.setStrokeStyle(5).beginStroke("red").beginFill("gray").drawRoundRect(SQ_X, SQ_Y, SQ_W, SQ_H,SQ_R,SQ_R,SQ_R,SQ_R);
	  		}
	
  		   var res_square = new createjs.Shape();
  		   res_square.graphics.beginStroke("white").beginFill("white").drawRect(SQ_X+res_x, SQ_Y+2, 3, SQ_H-4);
		   
		   var true_square = new createjs.Shape();
  		   true_square.graphics.beginStroke("green").beginFill("green").drawRect(SQ_X+true_x, SQ_Y+1, 1, SQ_H-2);
  		   stage.addChild(square);
		   stage.addChild(res_square);

		   if (IS_FEEDBACK) {stage.addChild(true_square);}
  		   
		   stage.update();

		   if (IS_FEEDBACK) {
			   if (isCorrect) {
				   document.getElementById("Feedback").innerHTML= "You clicked: " + res_xr + " %";

			   } else {
	     		   document.getElementById("Feedback").innerHTML= "You clicked: " + res_xr + " %" + ". This is not accurate enought. Let's try again...";
			   	   document.getElementById("Feedback").style.color = "red";
			   }
		    } else {
		    	 if (isCorrect) {
				   document.getElementById("Feedback").innerHTML= "Trial OK.";
				    document.getElementById("Feedback").style.color = "green";

			   } else {
	     		   document.getElementById("Feedback").innerHTML= "This is not accurate enought. Let's try again...";
			   	   document.getElementById("Feedback").style.color = "red";
			   }

		    }
		  
		   document.getElementById("Target").innerHTML= "Target: " + true_xr + " %";
		   document.getElementById("Target").innerHTML= "Target: "+ TRUE_RATIO + " % ";
		   setTimeout(function(){
		   	if (repeats<=MAX_REPATS) {
		   		if (!isCorrect) {init();}
		   	}
			    
		   }, WAIT_TIME);
		   document.getElementById("Debug").innerHTML= "Results: " + results.toString() + " Result: " + result + " Repeats: " + repeats +"/" + MAX_REPATS;
		 }

    </script>
</head>
<body onload="init();">
	<h1>Line Segmentation Game</h1>
	<p id="Counter"> Trial 1/1</p>
	<p id="Feedback">Segment the square according to the target's percentage: </p>
	<p id="Target"> Target: XX %</p>

    <canvas id="demoCanvas" width="700" height="300">
        
    </canvas>
    <p id="Debug"> </p>

</body>
</html>


